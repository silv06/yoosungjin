name: Daily Oreum Monitoring

on:
  schedule:
    # ë§¤ì¼ í•œêµ­ ì‹œê°„ ì˜¤ì „ 6ì‹œ (UTC 21:00) ì‹¤í–‰
    - cron: '0 21 * * *'
  # ìˆ˜ë™ìœ¼ë¡œ ì‹¤í–‰ ë²„íŠ¼(Run workflow)ì„ ëˆ„ë¥¼ ìˆ˜ ìˆê²Œ ì„¤ì •
  workflow_dispatch:

jobs:
  run-gee-analysis:
    runs-on: ubuntu-latest

    steps:
    # 1. ê¹ƒí—ˆë¸Œì— ìˆëŠ” ì½”ë“œ(main.py)ë¥¼ ê°€ìƒ ì»´í“¨í„°ë¡œ ê°€ì ¸ì˜µë‹ˆë‹¤.
    - name: ì½”ë“œ ì²´í¬ì•„ì›ƒ
      uses: actions/checkout@v3

    # 2. íŒŒì´ì¬ 3.10 ë²„ì „ì„ ì„¤ì¹˜í•©ë‹ˆë‹¤. (ê²½ê³  ë©”ì‹œì§€ í•´ê²°)
    - name: íŒŒì´ì¬ ì„¤ì •
      uses: actions/setup-python@v4
      with:
        python-version: '3.10'

    # 3. í•„ìš”í•œ ë¼ì´ë¸ŒëŸ¬ë¦¬ë“¤ì„ ì„¤ì¹˜í•©ë‹ˆë‹¤.
    - name: ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„¤ì¹˜
      run: |
        pip install earthengine-api pandas supabase google-auth

    # 4. [í•µì‹¬] ê¸ˆê³ (Secrets)ì—ì„œ ì—´ì‡ ë¥¼ êº¼ë‚´ íŒŒì´ì¬ì—ê²Œ ì „ë‹¬í•˜ë©° ì‹¤í–‰í•©ë‹ˆë‹¤.
    - name: íŒŒì´ì¬ ì½”ë“œ ì‹¤í–‰
      env:
        # ğŸ‘‡ ì´ ë¶€ë¶„ì´ ì—†ìœ¼ë©´ íŒŒì´ì¬ì€ ë¹ˆ ê°’(None)ë§Œ ë³´ê²Œ ë©ë‹ˆë‹¤.
        GEE_SERVICE_ACCOUNT_KEY: ${{ secrets.GEE_SERVICE_ACCOUNT_KEY }}
        SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
        SUPABASE_KEY: ${{ secrets.SUPABASE_KEY }}
      run: python main.py